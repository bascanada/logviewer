# Configuration for HL vs Native benchmark tests
# This file defines clients and contexts for comparing hl and native Go engine performance

clients:
  # Local client with hl support (paths-based)
  hl-local:
    type: local
    options:
      paths:
        - /tmp/logviewer-benchmark/logs-10000.json
      cmd: "cat /tmp/logviewer-benchmark/logs-10000.json"

  # Local client forcing native Go engine
  native-local:
    type: local
    options:
      paths:
        - /tmp/logviewer-benchmark/logs-10000.json
      cmd: "cat /tmp/logviewer-benchmark/logs-10000.json"
      preferNativeDriver: true

  # Local with large log file for performance testing
  hl-local-large:
    type: local
    options:
      paths:
        - /tmp/logviewer-benchmark/logs-1000000.json
      cmd: "cat /tmp/logviewer-benchmark/logs-1000000.json"

  native-local-large:
    type: local
    options:
      paths:
        - /tmp/logviewer-benchmark/logs-1000000.json
      cmd: "cat /tmp/logviewer-benchmark/logs-1000000.json"
      preferNativeDriver: true

  # SSH client with hl support (hybrid command)
  hl-ssh:
    type: ssh
    options:
      addr: "localhost:2222"
      user: "testuser"
      privateKey: "integration/ssh/id_rsa"
      disablePTY: true
      paths:
        - /data/logs-10000.json
      cmd: "cat /data/logs-10000.json"

  # SSH client forcing native (cat + client-side filtering)
  native-ssh:
    type: ssh
    options:
      addr: "localhost:2222"
      user: "testuser"
      privateKey: "integration/ssh/id_rsa"
      disablePTY: true
      paths:
        - /data/logs-10000.json
      cmd: "cat /data/logs-10000.json"
      preferNativeDriver: true

searches:
  # JSON extraction for benchmark logs
  json-benchmark:
    fieldExtraction:
      json: true
      jsonTimestampKey: "@timestamp"
      jsonLevelKey: "level"
      jsonMessageKey: "message"

  # Template for benchmark output (minimal)
  benchmark-output:
    printerOptions:
      template: '{{.Timestamp.Format "15:04:05.000"}} [{{.Level}}] {{.Message}}'

contexts:
  # ============================================
  # HL Engine Contexts (10K logs)
  # ============================================

  # Local with hl (auto-detected)
  local-hl:
    client: hl-local
    description: "Local logs with hl engine (if available)"
    searchInherit: ["json-benchmark", "benchmark-output"]
    search:
      fields: {}

  # Local with native Go engine (forced)
  local-native:
    client: native-local
    description: "Local logs with native Go engine"
    searchInherit: ["json-benchmark", "benchmark-output"]
    search:
      fields: {}

  # ============================================
  # Large File Contexts (1M logs)
  # ============================================

  local-hl-large:
    client: hl-local-large
    description: "Local large logs (1M) with hl engine"
    searchInherit: ["json-benchmark", "benchmark-output"]
    search:
      fields: {}

  local-native-large:
    client: native-local-large
    description: "Local large logs (1M) with native engine"
    searchInherit: ["json-benchmark", "benchmark-output"]
    search:
      fields: {}

  # ============================================
  # SSH Contexts
  # ============================================

  # SSH with hl (hybrid command)
  ssh-hl:
    client: hl-ssh
    description: "SSH logs with hl engine (if available on remote)"
    searchInherit: ["json-benchmark", "benchmark-output"]
    search:
      fields: {}

  # SSH with native (client-side filtering)
  ssh-native:
    client: native-ssh
    description: "SSH logs with native Go engine"
    searchInherit: ["json-benchmark", "benchmark-output"]
    search:
      fields: {}

  # ============================================
  # Filter Test Contexts
  # ============================================

  # Simple filter - hl
  hl-filter-simple:
    client: hl-local
    description: "HL: Simple level=ERROR filter"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: level
        value: ERROR

  # Simple filter - native
  native-filter-simple:
    client: native-local
    description: "Native: Simple level=ERROR filter"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: level
        value: ERROR

  # Negation filter - hl
  hl-filter-negate:
    client: hl-local
    description: "HL: Negation level!=DEBUG filter"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: level
        op: equals
        value: DEBUG
        negate: true

  # Negation filter - native
  native-filter-negate:
    client: native-local
    description: "Native: Negation level!=DEBUG filter"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: level
        op: equals
        value: DEBUG
        negate: true

  # Complex filter - hl
  hl-filter-complex:
    client: hl-local
    description: "HL: Complex (ERROR OR WARN) AND latency>=500"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        logic: AND
        filters:
          - logic: OR
            filters:
              - field: level
                value: ERROR
              - field: level
                value: WARN
          - field: latency_ms
            op: gte
            value: "500"

  # Complex filter - native
  native-filter-complex:
    client: native-local
    description: "Native: Complex (ERROR OR WARN) AND latency>=500"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        logic: AND
        filters:
          - logic: OR
            filters:
              - field: level
                value: ERROR
              - field: level
                value: WARN
          - field: latency_ms
            op: gte
            value: "500"

  # Regex filter - hl
  hl-filter-regex:
    client: hl-local
    description: "HL: Regex message~=.*timeout.*"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: message
        op: regex
        value: ".*timeout.*"

  # Regex filter - native
  native-filter-regex:
    client: native-local
    description: "Native: Regex message~=.*timeout.*"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: message
        op: regex
        value: ".*timeout.*"

  # Comparison filter - hl
  hl-filter-comparison:
    client: hl-local
    description: "HL: Comparison latency_ms>=1000"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: latency_ms
        op: gte
        value: "1000"

  # Comparison filter - native
  native-filter-comparison:
    client: native-local
    description: "Native: Comparison latency_ms>=1000"
    searchInherit: ["json-benchmark"]
    search:
      filter:
        field: latency_ms
        op: gte
        value: "1000"

  # Time range - hl
  hl-time-range:
    client: hl-local
    description: "HL: Last 1h time range"
    searchInherit: ["json-benchmark"]
    search:
      range:
        last: "1h"

  # Time range - native
  native-time-range:
    client: native-local
    description: "Native: Last 1h time range"
    searchInherit: ["json-benchmark"]
    search:
      range:
        last: "1h"
