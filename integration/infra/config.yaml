clients:
  # Splunk for Payment Service logs
  sim-splunk:
    type: splunk
    options:
      url: https://localhost:8089/services
      headers:
        authorization: "Basic YWRtaW46cGFzc3dvcmQ="
      searchBody:
        output_mode: json

  # OpenSearch for Order Service logs
  sim-opensearch:
    type: opensearch
    options:
      endpoint: http://localhost:9200

  # K8s for Frontend/Payment Processor pod logs
  sim-k8s:
    type: k8s
    options:
      kubeConfig: integration/k8s/k3s.yaml

  # CloudWatch via LocalStack for DynamoDB logs (if needed)
  sim-cloudwatch:
    type: cloudwatch
    options:
      region: us-east-1
      endpoint: http://localhost:4566

searches:
  # Extract structured fields from JSON logs
  json-structured:
    fieldExtraction:
      json: true
      jsonTimestampKey: "@timestamp"
      jsonLevelKey: "level"
      jsonMessageKey: "message"
  
  # Extract fields from K8s container logs
  k8s-log-extraction:
    fieldExtraction:
      # Extract timestamp from K8s log prefix: 2025-12-08T21:00:07.649960977Z
      timestampRegex: '^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+Z)'
      # Extract log level (INFO, ERROR, WARN, DEBUG)
      groupRegex: '(?P<level>INFO|ERROR|WARN|DEBUG|FATAL)'
      # Extract key=value pairs like trace_id=abc-123
      kvRegex: '([a-zA-Z_]+)=([^\s]+)'
  
  # Pretty print for demo (simplified for K8s)
  transaction-view:
    printerOptions:
      template: '[{{.Timestamp.Format "15:04:05"}}]{{if .Field "level"}} [{{.Field "level"}}]{{end}}{{if .Field "app"}} [{{.Field "app"}}]{{end}}{{if .Field "pod"}} [{{.Field "pod"}}]{{end}} {{if .Field "message"}}{{.Field "message"}}{{else}}{{.Message}}{{end}}{{if .Field "trace_id"}} (trace: {{.Field "trace_id"}}){{end}}'

contexts:
  payment-service:
    client: sim-splunk
    description: "Payment Service logs from Splunk"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      fields: {}
      options:
        index: main
        search: 'sourcetype=json app="payment-service"'

  order-service:
    client: sim-opensearch
    description: "Order Service logs from OpenSearch"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      fields: {}
      options:
        index: app-logs
        query: 'app:"order-service"'

  api-gateway:
    client: sim-opensearch
    description: "API Gateway logs from OpenSearch"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      fields: {}
      options:
        index: app-logs
        query: 'app:"api-gateway"'

  payment-processor-pod:
    client: sim-k8s
    description: "Payment Processor pod logs from Kubernetes"
    searchInherit: []
    search:
      fields: {}
      options:
        namespace: default
        pod: ${PAYMENT_POD}
        container: log-generator
        timestamp: true

  # All Payment Processor pods (auto-discovery)
  payment-processor-all:
    client: sim-k8s
    description: "All Payment Processor pods logs from Kubernetes"
    searchInherit: ["k8s-log-extraction", "transaction-view"]
    search:
      fields: {}
      options:
        namespace: default
        labelSelector: "app=payment-processor"
        timestamp: true

  # Combined view - all Splunk logs (all services)
  splunk-all:
    client: sim-splunk
    description: "All Splunk logs"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      fields: {}
      options:
        index: main
        search: 'sourcetype=json'

  # Combined view - all OpenSearch logs
  opensearch-all:
    client: sim-opensearch
    description: "All OpenSearch logs"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      fields: {}
      options:
        index: app-logs

  # CloudWatch logs (if using LocalStack for additional logging)
  cloudwatch-orders:
    client: sim-cloudwatch
    description: "CloudWatch logs via LocalStack"
    searchInherit: []
    search:
      fields: {}
      options:
        logGroupName: my-app-logs
        useInsights: false

  # Native Query examples for testing
  splunk-native-query:
    client: sim-splunk
    description: "Splunk with native SPL query - basic search"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      nativeQuery: 'index=main sourcetype=httpevent'
      range:
        last: 24h

  splunk-native-stats:
    client: sim-splunk
    description: "Splunk with transforming command (stats) - uses /results endpoint"
    searchInherit: []
    search:
      nativeQuery: 'index=main sourcetype=httpevent | stats count by level, app'
      range:
        last: 24h

  splunk-native-timechart:
    client: sim-splunk
    description: "Splunk timechart - uses /results endpoint"
    searchInherit: []
    search:
      nativeQuery: 'index=main sourcetype=httpevent | timechart span=1h count by level'
      range:
        last: 24h

  splunk-native-with-filter:
    client: sim-splunk
    description: "Splunk native query with additional filters"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      nativeQuery: 'index=main sourcetype=httpevent'
      filter:
        logic: OR
        filters:
          - field: level
            value: ERROR
          - field: level
            value: WARN
      range:
        last: 24h

  opensearch-native-query:
    client: sim-opensearch
    description: "OpenSearch with native Lucene query"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      nativeQuery: 'level:ERROR OR level:WARN'
      options:
        index: app-logs
      range:
        last: 1h

  opensearch-native-with-filter:
    client: sim-opensearch
    description: "OpenSearch native query with additional filters"
    searchInherit: ["json-structured", "transaction-view"]
    search:
      nativeQuery: 'message:*error* OR message:*fail*'
      filter:
        field: app
        value: order-service
      options:
        index: app-logs
      range:
        last: 1h

  # === TEST-SPECIFIC CONTEXTS (for E2E tests with seeded data) ===

  # Test context for error logs fixture (50 ERROR logs)
  test-splunk-errors:
    client: sim-splunk
    description: "Test context for error logs (Splunk)"
    searchInherit: ["json-structured"]
    search:
      fields: {}
      options:
        index: test-e2e-errors
        search: 'sourcetype=json'

  # Test context for payment logs fixture (100 mixed payment logs)
  test-splunk-payments:
    client: sim-splunk
    description: "Test context for payment logs (Splunk)"
    searchInherit: ["json-structured"]
    search:
      fields: {}
      options:
        index: test-e2e-payments
        search: 'sourcetype=json'

  # Test context for order logs fixture (75 order service logs)
  test-opensearch-orders:
    client: sim-opensearch
    description: "Test context for order logs (OpenSearch)"
    searchInherit: ["json-structured"]
    search:
      fields: {}
      options:
        index: test-e2e-orders

  # Test context for mixed levels fixture (100 logs with mixed levels)
  test-opensearch-mixed:
    client: sim-opensearch
    description: "Test context for mixed level logs (OpenSearch)"
    searchInherit: ["json-structured"]
    search:
      fields: {}
      options:
        index: test-e2e-mixed

  # Test context for trace logs fixture (30 logs with trace_ids)
  test-splunk-traces:
    client: sim-splunk
    description: "Test context for trace logs (Splunk)"
    searchInherit: ["json-structured"]
    search:
      fields: {}
      options:
        index: test-e2e-traces
        search: 'sourcetype=json'

  # Test context for slow requests fixture (25 logs with high latency)
  test-opensearch-slow:
    client: sim-opensearch
    description: "Test context for slow request logs (OpenSearch)"
    searchInherit: ["json-structured"]
    search:
      fields: {}
      options:
        index: test-e2e-slow
